<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Web Socket Example</title>
    <script src="jquery/jquery.min.js"></script>

    <!-- <link rel="stylesheet" href="css/style.css"> -->
    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<body id="home">
    <h1>Web Socket Example</h1>
    <p>Open Console to see connection.</p><br><br>

    <form id="form">
      <input type="text" value="Hello there" id="message">
      <input type="submit" value="Go">
    </form>

    <h4>Messages </h4>
    <div id="messages" style="border: 1px solid; font-size: 12px;">

    </div>

    <script>
      'use strict';

        var ws = null;

        document.addEventListener("DOMContentLoaded", function() {
          function start(){

            ws = new WebSocket("wss://localhost:40510");
            ws.onopen = function(){
                console.log('Websocket connected!');
                ws.send('Ping')
            };
            ws.onmessage = function(e){
              console.log(e.data);
              $("#messages").prepend("<p>" + e.data + "</p>");
            };
            ws.onclose = function(){
              console.log('Websocket closed!');

              // reconnect now
              check();
            };

          }

          function check(){
            if(!ws || ws.readyState == 3) start();
          }

          start();
          setInterval(check, 5000);
        });

        $( "#form" ).submit(function( e ) {
          e.preventDefault();
          ws.send($('#message').val());
        });


        /** Example of a DoS attack **

            setInterval( () => {
                let ws1 = new WebSocket('ws://localhost:40510')

                ws1.onopen = function () {
                    console.log('Websocket Connected!')
                    ws.send('Websocket Connected!')
                }
            }, 1000)
        */

        /*
           FIXME - write if else for ws / wss according to the http or https ?
           const ws = new WebSocket('ws://localhost:40510');
        */

    </script>
</body>
</html>